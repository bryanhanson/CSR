<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bryan Hanson">
<meta name="dcterms.date" content="2022-02-09">
<meta name="description" content="Hints For Package Developers">

<title>Chemometrics and Spectroscopy Using R - Do You have Stale Imports or Suggests?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Chemometrics and Spectroscopy Using R - Do You have Stale Imports or Suggests?">
<meta name="twitter:description" content="Hints For Package Developers">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Chemometrics and Spectroscopy Using R</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html">Projects</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.r-bloggers.com/">R-Bloggers</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:hanson@depauw.edu"><i class="bi bi-envelope-fill" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/profbryanhanson"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bryanhanson"><i class="bi bi-git" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Do You have Stale Imports or Suggests?</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">Utilities</div>
    <div class="quarto-category">Developers</div>
  </div>
  </div>

<div>
  <div class="description">
    Hints For Package Developers
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bryan Hanson </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 9, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<div class="cell">

</div>
<p>I’ve been developing packages in <code>R</code> for over a decade now. When adding new features to a package, I often import functions from another package, and of course that package goes in the <code>Imports:</code> field of the <code>DESCRIPTION</code> file. Later, I might change my approach entirely and no longer need that package. Do I remember to remove it from <code>DESCRIPTION</code>? Generally not. The same thing happens when writing a new vignette, and it can happen with the <code>Suggests:</code> field as well. It can also happen when one splits a packages into several smaller packages. If one forgets to delete a package from the <code>DESCRIPTION</code> file, the dependencies become bloated, because all the imported and suggested packages have to be available to install the package. This adds overhead to the project, and increases the possibility of a namespace conflict.</p>
<p>In fact this just happened to me <em>again!</em> The author of a package I had in <code>Suggests:</code> wrote to me and let me know their package would be archived. It was an easy enough fix for me, as it was a “stale” package in that I was no longer using it. I had added it for a vignette which I later deleted, as I decided a series of blog posts was a better approach.</p>
<p>So I decided to write a little function to check for such stale <code>Suggests:</code> and <code>Import:</code> entries. This post is about that function. As far as I can tell there is no built-in function for this purpose, and CRAN does not check for stale entries. So it was worth my time to automate the process.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The first step is to read in the <code>DESCRIPTION</code> file for the package (so we want our working directory to be the top level of the package). There is a built in function for this. We’ll use the <code>DESCRIPTION</code> file from the <code>ChemoSpec</code> package as a demonstration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># setwd("...") # set to the top level of the package</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>desc <span class="ot">&lt;-</span> <span class="fu">read.dcf</span>(<span class="st">"DESCRIPTION"</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The argument <code>all = TRUE</code> is a bit odd in that it has a particular purpose (see <code>?read.dcf</code>) which isn’t really important here, but has the side effect of returning a data frame, which makes our job simpler. Let’s look at what is returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">str</span>(desc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1 obs. of  18 variables:
 $ Package         : chr "ChemoSpec"
 $ Type            : chr "Package"
 $ Title           : chr "Exploratory Chemometrics for Spectroscopy"
 $ Version         : chr "6.1.2"
 $ Date            : chr "2022-02-08"
 $ Authors@R       : chr "c(\nperson(\"Bryan A.\", \"Hanson\",\nrole = c(\"aut\", \"cre\"), email =\n\"hanson@depauw.edu\",\ncomment = c("| __truncated__
 $ Description     : chr "A collection of functions for top-down exploratory data analysis\nof spectral data including nuclear magnetic r"| __truncated__
 $ License         : chr "GPL-3"
 $ Depends         : chr "R (&gt;= 3.5),\nChemoSpecUtils (&gt;= 1.0)"
 $ Imports         : chr "plyr,\nstats,\nutils,\ngrDevices,\nreshape2,\nreadJDX (&gt;= 0.6),\npatchwork,\nggplot2,\nplotly,\nmagrittr"
 $ Suggests        : chr "IDPmisc,\nknitr,\njs,\nNbClust,\nlattice,\nbaseline,\nmclust,\npls,\nclusterCrit,\nR.utils,\nRColorBrewer,\nser"| __truncated__
 $ URL             : chr "https://bryanhanson.github.io/ChemoSpec/"
 $ BugReports      : chr "https://github.com/bryanhanson/ChemoSpec/issues"
 $ ByteCompile     : chr "TRUE"
 $ VignetteBuilder : chr "knitr"
 $ Encoding        : chr "UTF-8"
 $ RoxygenNote     : chr "7.1.2"
 $ NeedsCompilation: chr "no"</code></pre>
</div>
</div>
<p>We are interested in the <code>Imports</code> and <code>Suggests</code> elements. Let’s look more closely.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">head</span>(desc<span class="sc">$</span>Imports)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "plyr,\nstats,\nutils,\ngrDevices,\nreshape2,\nreadJDX (&gt;= 0.6),\npatchwork,\nggplot2,\nplotly,\nmagrittr"</code></pre>
</div>
</div>
<p>You can see there are a bunch of newlines in there (<code>\n</code>), along with some version specifications, in parentheses. We need to clean this up so we have a simple list of the packages as a vector. For clean up we’ll use the following helper function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>clean_up <span class="ot">&lt;-</span> <span class="cf">function</span>(string) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  string <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="st">""</span>, string) <span class="co"># remove newlines</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  string <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(.+</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, string) <span class="co"># remove parens &amp; anything within them</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  string <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(string, <span class="st">","</span>)) <span class="co"># split the long string into pieces</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  string <span class="ot">&lt;-</span> <span class="fu">trimws</span>(string) <span class="co"># remove any white space around words</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After we apply this to the raw results, we have what we are after, a clean list of imported packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">clean_up</span>(desc<span class="sc">$</span>Imports)</span>
<span id="cb7-2"><a href="#cb7-2"></a>imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "plyr"      "stats"     "utils"     "grDevices" "reshape2"  "readJDX"  
 [7] "patchwork" "ggplot2"   "plotly"    "magrittr" </code></pre>
</div>
</div>
<p>Next, we can search the entire package looking for these package names to see if they are used in the package. They might appear in import statements, vignettes, code and so forth, so it’s not sufficient to just look at code. This is a job for <code>grep</code>, but we’ll call <code>grep</code> from within <code>R</code> so that we don’t have to use the command line and transfer the results to <code>R</code>, that gets messy and is error-prone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="cf">if</span> (<span class="fu">length</span>(imp) <span class="sc">&gt;=</span> <span class="dv">1</span>) { <span class="co"># Note 1</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  imp_res <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"FALSE"</span>, <span class="fu">length</span>(imp)) <span class="co"># Boolean to keep track of whether we found a package or not</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(imp)) {</span>
<span id="cb9-4"><a href="#cb9-4"></a>    args <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"-r -e '"</span>, imp[i], <span class="st">"' *"</span>, <span class="at">sep =</span> <span class="st">""</span>) <span class="co"># assemble arguments for grep</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>    g_imp <span class="ot">&lt;-</span> <span class="fu">system2</span>(<span class="st">"grep"</span>, args, <span class="at">stdout =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="cf">if</span> (<span class="fu">length</span>(g_imp) <span class="sc">&gt;</span> 1L) imp_res[i] <span class="ot">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># Note 2</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  }</span>
<span id="cb9-8"><a href="#cb9-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Note 1: We ought to check if there are any imports at all. It would be a bit unusual, but it’s possible to have zero imports.</li>
<li>Note 2: <code>g_imp</code> contains the results of the grep process. If there <em>are</em> imports in the package, each imported package name will be found by grep in the <code>DESCRIPTION</code> file. That’s not so interesting, so we don’t count it. For a package to be stale, it will be found in <code>DESCRIPTION</code> <em>but no where else</em>.</li>
</ul>
<p>We can do the same process for the <code>Suggests:</code> field of <code>DESCRIPTION</code>. And then it would be nice to present the results in a more useable form. At this point we can put it all togther in an easy-to-use function.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># run from the package top level</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>check_stale_imports_suggests <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="co"># helper function: removes extra characters</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="co"># from strings read by read.dcf</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  clean_up <span class="ot">&lt;-</span> <span class="cf">function</span>(string) {</span>
<span id="cb10-7"><a href="#cb10-7"></a>    string <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="st">""</span>, string)</span>
<span id="cb10-8"><a href="#cb10-8"></a>    string <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(.+</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, string)</span>
<span id="cb10-9"><a href="#cb10-9"></a>    string <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(string, <span class="st">","</span>))</span>
<span id="cb10-10"><a href="#cb10-10"></a>    string <span class="ot">&lt;-</span> <span class="fu">trimws</span>(string)</span>
<span id="cb10-11"><a href="#cb10-11"></a>  }</span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a>  desc <span class="ot">&lt;-</span> <span class="fu">read.dcf</span>(<span class="st">"DESCRIPTION"</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="co"># look for use of imported packages</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>  imp <span class="ot">&lt;-</span> <span class="fu">clean_up</span>(desc<span class="sc">$</span>Imports)</span>
<span id="cb10-17"><a href="#cb10-17"></a>  <span class="cf">if</span> (<span class="fu">length</span>(imp) <span class="sc">==</span> 0L) <span class="fu">message</span>(<span class="st">"No Imports: entries found"</span>)</span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="cf">if</span> (<span class="fu">length</span>(imp) <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb10-19"><a href="#cb10-19"></a>    imp_res <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"FALSE"</span>, <span class="fu">length</span>(imp))</span>
<span id="cb10-20"><a href="#cb10-20"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(imp)) {</span>
<span id="cb10-21"><a href="#cb10-21"></a>      args <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"-r -e '"</span>, imp[i], <span class="st">"' *"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb10-22"><a href="#cb10-22"></a>      g_imp <span class="ot">&lt;-</span> <span class="fu">system2</span>(<span class="st">"grep"</span>, args, <span class="at">stdout =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-23"><a href="#cb10-23"></a>      <span class="co"># always found once in DESCRIPTION, hence &gt; 1</span></span>
<span id="cb10-24"><a href="#cb10-24"></a>      <span class="cf">if</span> (<span class="fu">length</span>(g_imp) <span class="sc">&gt;</span> 1L) imp_res[i] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb10-25"><a href="#cb10-25"></a>    }</span>
<span id="cb10-26"><a href="#cb10-26"></a>  }</span>
<span id="cb10-27"><a href="#cb10-27"></a></span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="co"># look for use of suggested packages</span></span>
<span id="cb10-29"><a href="#cb10-29"></a>  sug <span class="ot">&lt;-</span> <span class="fu">clean_up</span>(desc<span class="sc">$</span>Suggests)</span>
<span id="cb10-30"><a href="#cb10-30"></a>  <span class="cf">if</span> (<span class="fu">length</span>(sug) <span class="sc">==</span> 0L) <span class="fu">message</span>(<span class="st">"No Suggests: entries found"</span>)</span>
<span id="cb10-31"><a href="#cb10-31"></a>  <span class="cf">if</span> (<span class="fu">length</span>(sug) <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb10-32"><a href="#cb10-32"></a>    sug_res <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"FALSE"</span>, <span class="fu">length</span>(sug))</span>
<span id="cb10-33"><a href="#cb10-33"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sug)) {</span>
<span id="cb10-34"><a href="#cb10-34"></a>      args <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"-r -e '"</span>, sug[i], <span class="st">"' *"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb10-35"><a href="#cb10-35"></a>      g_sug <span class="ot">&lt;-</span> <span class="fu">system2</span>(<span class="st">"grep"</span>, args, <span class="at">stdout =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-36"><a href="#cb10-36"></a>      <span class="co"># always found once in DESCRIPTION, hence &gt; 1</span></span>
<span id="cb10-37"><a href="#cb10-37"></a>      <span class="cf">if</span> (<span class="fu">length</span>(g_sug) <span class="sc">&gt;</span> 1L) sug_res[i] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb10-38"><a href="#cb10-38"></a>    }</span>
<span id="cb10-39"><a href="#cb10-39"></a>  }</span>
<span id="cb10-40"><a href="#cb10-40"></a></span>
<span id="cb10-41"><a href="#cb10-41"></a>  <span class="co"># arrange output in easy to read format</span></span>
<span id="cb10-42"><a href="#cb10-42"></a>  role <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Imports"</span>, <span class="fu">length</span>(imp)), <span class="fu">rep</span>(<span class="st">"Suggests"</span>, <span class="fu">length</span>(sug)))</span>
<span id="cb10-43"><a href="#cb10-43"></a></span>
<span id="cb10-44"><a href="#cb10-44"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb10-45"><a href="#cb10-45"></a>    <span class="at">pkg =</span> <span class="fu">c</span>(imp, sug),</span>
<span id="cb10-46"><a href="#cb10-46"></a>    <span class="at">role =</span> role,</span>
<span id="cb10-47"><a href="#cb10-47"></a>    <span class="at">found =</span> <span class="fu">c</span>(imp_res, sug_res)))</span>
<span id="cb10-48"><a href="#cb10-48"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Applying this function to my <code>ChemoSpec2D</code> package (as of the date of this post), we see the following output. You can see a bunch of packages are imported but never used, so I have some work to do. This was the result of copying the <code>DESCRIPTION</code> file from <code>ChemoSpec</code> when I started <code>ChemoSpec2D</code> and obviously I never went back and cleaned things up.</p>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>            pkg     role found</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="dv">1</span>          plyr  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="dv">2</span>         stats  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="dv">3</span>         utils  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="dv">4</span>     grDevices  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="dv">5</span>      reshape2  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="dv">6</span>       readJDX  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="dv">7</span>     patchwork  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="dv">8</span>       ggplot2  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="dv">9</span>        plotly  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="dv">10</span>     magrittr  Imports  <span class="cn">TRUE</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="dv">11</span>      IDPmisc Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="dv">12</span>        knitr Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="dv">13</span>           js Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="dv">14</span>      NbClust Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="dv">15</span>      lattice Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="dv">16</span>     baseline Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="dv">17</span>       mclust Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="dv">18</span>          pls Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="dv">19</span>  clusterCrit Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="dv">20</span>      R.utils Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="dv">21</span> RColorBrewer Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="dv">22</span>    seriation Suggests <span class="cn">FALSE</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="dv">23</span>         MASS Suggests <span class="cn">FALSE</span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="dv">24</span>   robustbase Suggests <span class="cn">FALSE</span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="dv">25</span>         grid Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="dv">26</span>        pcaPP Suggests <span class="cn">FALSE</span></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="dv">27</span>     jsonlite Suggests <span class="cn">FALSE</span></span>
<span id="cb11-29"><a href="#cb11-29"></a><span class="dv">28</span>       gsubfn Suggests <span class="cn">FALSE</span></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="dv">29</span>       signal Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="dv">30</span>        speaq Suggests <span class="cn">FALSE</span></span>
<span id="cb11-32"><a href="#cb11-32"></a><span class="dv">31</span>     tinytest Suggests <span class="cn">FALSE</span></span>
<span id="cb11-33"><a href="#cb11-33"></a><span class="dv">32</span>   elasticnet Suggests <span class="cn">FALSE</span></span>
<span id="cb11-34"><a href="#cb11-34"></a><span class="dv">33</span>        irlba Suggests <span class="cn">FALSE</span></span>
<span id="cb11-35"><a href="#cb11-35"></a><span class="dv">34</span>         amap Suggests <span class="cn">FALSE</span></span>
<span id="cb11-36"><a href="#cb11-36"></a><span class="dv">35</span>    rmarkdown Suggests  <span class="cn">TRUE</span></span>
<span id="cb11-37"><a href="#cb11-37"></a><span class="dv">36</span>     bookdown Suggests <span class="cn">FALSE</span></span>
<span id="cb11-38"><a href="#cb11-38"></a><span class="dv">37</span> chemometrics Suggests <span class="cn">FALSE</span></span>
<span id="cb11-39"><a href="#cb11-39"></a><span class="dv">38</span>    hyperSpec Suggests <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>




<script data-goatcounter="https://chemospec.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>As you will see in a moment, during testing I found a bunch of stale entries I need to remove from several packages!<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In easy to use form as a <a href="https://gist.github.com/bryanhanson/4c8ac99903df65af9c7e11a972447bc5">Gist</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hanson2022,
  author = {Bryan Hanson},
  editor = {},
  title = {Do {You} Have {Stale} {Imports} or {Suggests?}},
  date = {2022-02-09},
  url = {http://chemospec.org/posts/2022-02-09-Imports-Suggests/2022-02-09-Imports-Suggests.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hanson2022" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Bryan Hanson. 2022. <span>“Do You Have Stale Imports or
Suggests?”</span> February 9, 2022. <a href="http://chemospec.org/posts/2022-02-09-Imports-Suggests/2022-02-09-Imports-Suggests.html">http://chemospec.org/posts/2022-02-09-Imports-Suggests/2022-02-09-Imports-Suggests.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="bryanhanson/CSR" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookies are used to track visits only</a></div></div>
  </div>
</footer>



</body></html>