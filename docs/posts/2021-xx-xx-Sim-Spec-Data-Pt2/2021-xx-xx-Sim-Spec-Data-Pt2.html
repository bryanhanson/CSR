<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bryan Hanson">
<meta name="dcterms.date" content="2020-05-27">
<meta name="description" content="Needs Work!">

<title>Chemometrics and Spectroscopy Using R - Simulating Spectroscopic Data Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="../../site_libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="../../site_libs/bsTable-3.3.7/bootstrapTable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Chemometrics and Spectroscopy Using R - Simulating Spectroscopic Data Part 2">
<meta name="twitter:description" content="Needs Work!">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Chemometrics and Spectroscopy Using R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.r-bloggers.com/"> 
<span class="menu-text">R-Bloggers</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:hanson@depauw.edu"> <i class="bi bi-envelope-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/profbryanhanson"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/%40ProfBryanHanson" rel="me"> <i class="bi bi-mastodon" role="img" aria-label="Mastodon">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bryanhanson"> <i class="bi bi-git" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-071822.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fcfcfc; clear:left; font:14px Helvetica,Arial,sans-serif; }
    /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
    <form action="https://chemospec.us21.list-manage.com/subscribe/post?u=1e9f5b8abbc42dc8ff815ba3d&amp;id=d824c5574e&amp;f_id=00b9c6e1f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
        <div id="mc_embed_signup_scroll">
        <h2>Subscribe</h2>
        <!-- <div class="indicates-required"><span class="asterisk">*</span> indicates required</div> -->
<div class="mc-field-group">
    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" required="">
    <span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span>
</div>
    <div id="mce-responses" class="clear foot">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_1e9f5b8abbc42dc8ff815ba3d_d824c5574e" tabindex="-1" value=""></div>
        <div class="optionalParent">
            <div class="clear foot">
                <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
                <!-- <p class="brandingLogo"><a href="http://eepurl.com/ic07Vr" title="Mailchimp - email marketing made easy and fun"><img src="https://eep.io/mc-cdn-images/template_images/branding_logo_text_dark_dtp.svg"></a></p> -->
            </div>
        </div>
    </div>
</form>
</div>
<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->

</div></div>
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simulating Spectroscopic Data Part 2</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">Simulated Data</div>
    <div class="quarto-category">Noise</div>
  </div>
  </div>

<div>
  <div class="description">
    Needs Work!
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bryan Hanson </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 27, 2020</p>
    </div>
  </div>
  
    
  </div>
  


</header>

<p>In the first <a href="https://chemospec.org/2020/06/28/p15/">post</a> in this series, we showed how to vary the peak shape and add various baseline distortions when simulating spectroscopic data. In this post we’ll look at types and sources of noise and how to simulate noise. Full disclosure: I don’t claim to be an expert on noise. I have enough experience to know some useful information and to realize that there is much more to learn. So please feel free to correct, elaborate or clarify anything you read here, via the comments.</p>
<section id="types-sources-of-noise" class="level2">
<h2 class="anchored" data-anchor-id="types-sources-of-noise">Types &amp; Sources of Noise</h2>
<p>Before jumping into the practical aspects of simulating noise, let’s survey some of the types and sources of noise in spectroscopic instrumentation. After all, we need at least a rudimentary understanding of where noise comes from, and how it behaves, in order to simulate it. The literature on noise issues is complex, instrument-specific and the nomenclature a little loose for my tastes. So I’m going to organize this post in my own unique way, reflecting my own journey to a better understanding of this material. I’m going to focus on <em>raw</em> sources of noise, and ignore ways one might abuse the signal at later stages in the acquistion process to create even more noise.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <em>Do not</em> take this post as a comprehensive treatment of the topic!</p>
<p>As I have tried to better understand noise, it seems that we need to look at noise in two ways at the same time:</p>
<ul>
<li>The <em>type</em> of noise: By “type” I mean the behavior of noise with respect to frequency. Does the noise depend on the frequency in any way? This is primarily a phenomenological description. One encounters <a href="https://en.wikipedia.org/wiki/Colors_of_noise">descriptions</a> of noise as “white”, “pink” etc but to my thinking this is not helpful. Better to simply state the frequency dependency, which is usually expressed as <span class="math inline">\(1/f^\beta\)</span>. In spectroscopy “white” noise is independent of frequency (<span class="math inline">\(\beta = 0\)</span>) while flicker noise has <span class="math inline">\(\beta = 1\)</span> so it is a bigger problem at lower frequencies.</li>
<li>The <em>source</em> or origin of noise: By what means does the noise come into being? Of course it all comes from instrument hardware and electronics, and as such will vary by the type of instrumentation and circuit design. But can we pinpoint some specifics?</li>
</ul>
<p>We’ll try to keep these two dimensions in mind as we look at details.</p>
<section id="noise-originating-from-thermal-agitation" class="level3">
<h3 class="anchored" data-anchor-id="noise-originating-from-thermal-agitation">Noise Originating From Thermal Agitation</h3>
<p><a href="https://en.wikipedia.org/wiki/Johnson%E2%80%93Nyquist_noise"><em>Thermal noise</em></a> arises from the intrinsic motion of atoms, which is temperature dependent. The thermal motion of atoms, electrons and positive holes in a solid, like a CCD or a wire, is distantly related to the <a href="https://en.wikipedia.org/wiki/Maxwell%E2%80%93Boltzmann_distribution">Maxwell-Boltzmann</a> distribution for gases. At any moment, in the absence of any stimuli other than the temperature, some small fraction of electrons or positive holes will have enough velocity (“wiggle”, or vibration) in the lattice to create a random movement of charge, which will in turn be seen as noise.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Thermal noise occurs in all electronic circuits. Because it is ultimately related to charge motion, cooling a detector reduces the thermal noise of the signal. This is the basis for the use of cryo probes in NMR or Raman spectroscopy for example. Thermal noise follows a Gaussian distribution and is frequency and voltage independent.</p>
<p>I believe that all spectroscopic noise is ultimately thermal noise (read on to see why).</p>
</section>
<section id="noise-originating-from-counting-discrete-species" class="level3">
<h3 class="anchored" data-anchor-id="noise-originating-from-counting-discrete-species">Noise Originating From Counting Discrete Species</h3>
<p>Any physical device that counts discrete species such as photons, electrons or other charged particles suffers from <em>shot noise</em>. Examples include <a href="https://en.wikipedia.org/wiki/Charge-coupled_device">CCD</a> detectors, <a href="https://en.wikipedia.org/wiki/Electron_multiplier">electron multipliers</a> and <a href="https://en.wikipedia.org/wiki/Geiger%E2%80%93M%C3%BCller_tube">geiger counters</a>. In addition, electronic devices that involve the storage or movement of charges (in other words, all of them) are also subject to shot noise <em>if we are counting charges</em>.</p>
<p>So what is <a href="https://en.wikipedia.org/wiki/Shot_noise">shot noise</a>? It is noise that can be modeled by the <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a>. This distribution is used to describe discrete events that occur in a fixed interval of time<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> and independently from each other. Wikipedia uses the example of letters that arrive in the mail: The number of letters arriving on any given day is <em>independent</em> of the number that arrived the day before or will arrive the day after. And it’s <em>discrete</em>: you can get one letter or two, never 1.5 letters. For a spectroscopic example, consider a CCD device in the absence of any incident light. The tiny capacitors that make up a CCD are subject to <em>thermal noise</em> (see above) which means that even in the absence of incident light a small number of them can accidently “fire” at any time and produce a signal (the <em>dark current</em>). Even though thermal noise may be the origin of this signal, the device converts these signals into counts via its ADC hardware and therefore its nature has changed.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Thus the dark current represents counts and is shot noise that follows a Poisson distribution.</p>
<p>An important characteristic of the Poisson distribution is that it is sometimes referred to as the “law of rare events”. This is because when there are just a few events, the distribution is heavily skewed <a href="https://en.wikipedia.org/wiki/Poisson_distribution#/media/File:Poisson_pmf.svg">left</a>. However, as the number of events increases, the Poisson distribution can be approximated by the Gaussian or normal distribution.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> We’ll see how that matters later. Further, shot noise is independent of temperature or frequency. This distinguishes it from other types of noise.</p>
<p>Since all spectroscopic methods employ some kind of physical device as a detector, the net result is that shot noise is always present and is unavoidable in real, imperfect, physical devices.</p>
</section>
<section id="noise-originating-from-imperfect-electronic-circuits" class="level3">
<h3 class="anchored" data-anchor-id="noise-originating-from-imperfect-electronic-circuits">Noise Originating From Imperfect Electronic Circuits</h3>
<p><a href="https://en.wikipedia.org/wiki/Flicker_noise"><em>Flicker noise</em></a> is noise that depends upon the frequency observed, becoming worse at low frequencies (an inverse relationship, <span class="math inline">\(\beta = 1\)</span>). It’s origin is in electronic devices operating at DC voltages, for instance a laser intensity that varies with frequency (<span class="math inline">\(1/f\)</span>), as well as RF circuits (I’m looking at you NMR). A number of sources state that it’s true origin is unclear but that it does seem related to something fundamental in semi-conductor manufacture <span class="citation" data-cites="Carter2009">[@Carter2009]</span>.</p>
</section>
<section id="relative-contribution-of-noise-sources" class="level3">
<h3 class="anchored" data-anchor-id="relative-contribution-of-noise-sources">Relative Contribution of Noise Sources</h3>
</section>
<section id="summary-of-noise-sources" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-noise-sources">Summary of Noise Sources</h3>
<div class="cell-output-display">
<table class="table table-striped table-bordered" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Temp Dependent</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Freq Dependent</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Voltage Dependent</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Distribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">shot noise</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">?</td>
<td style="text-align: left;">Poisson</td>
</tr>
<tr class="even">
<td style="text-align: left;">thermal noise</td>
<td style="text-align: left;">yes</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">Gaussian</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flicker noise</td>
<td style="text-align: left;">?</td>
<td style="text-align: left;">yes</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">Gaussian</td>
</tr>
</tbody>
</table>


</div>
</section>
<section id="artifacts" class="level3">
<h3 class="anchored" data-anchor-id="artifacts">Artifacts</h3>
<p>The distinction between artifacts and noise might be somewhat arbitrary in practice. At least some artifacts are phenomenon that can in principle be eliminated by better instrument design. Here are a few examples:</p>
<ul>
<li><em>Stray light</em> For example, UV-Vis reflection probes are very good about picking up the main emission lines of flourescent lighting in a room.</li>
<li><em>Cosmic rays</em> Cosmic rays cause strong and sharp peaks in Raman spectra at random frequencies. See <span class="citation" data-cites="Ryabchykov2016">[@Ryabchykov2016]</span> for an algorithm to remove them.</li>
<li><em>Vibrations</em> Building vibrations can affect instrumentation negatively. In my prior life we had an NMR instrument on the 3rd floor of an extremely solid poured-concrete building. Nevertheless, there were vibrations from unknown sources that degraded the shape near the base of peaks. This was solved by adding a vibration-isolation table under the magnet.</li>
<li><em>Other Mechanical Sources</em> The interferometer in FT-IR instruments employs a mechanical oscillating movement which is subject to jitter (imperfect positioning). This is discussed in this <a href="https://dsp.stackexchange.com/a/60031/18705">Stack Exchange</a> question.</li>
<li><em>Interference Fringes</em> These arise in IR from differing refractive indices of the sample and the substrate it sits on. For a good discussion and some methods to eliminate the effect, see <span class="citation" data-cites="Mayerhöfer2020">[@Mayerhöfer2020]</span>.</li>
</ul>
<p>Simulating these artifacts will depend on the specific details; some like cosmic rays are easy to simulate while others could be quite complicated. We won’t discuss these further here.</p>
</section>
</section>
<section id="simulation-of-noise" class="level2">
<h2 class="anchored" data-anchor-id="simulation-of-noise">Simulation of Noise</h2>
<p>heterscedastic</p>
<section id="additional-resources" class="level3">
<h3 class="anchored" data-anchor-id="additional-resources">Additional Resources</h3>
<ul>
<li>An excellent on-line text book about signal processing by <a href="https://terpconnect.umd.edu/~toh/spectrum/TOC.html">Tom O’Haver</a>.</li>
<li>A good discussion of noise in <a href="https://ibsen.com/technology/detector-tutorial/noise-in-detectors/">CCD detectors</a>.</li>
<li>A key book on Raman spectroscopy, which includes extensive discussion of noise see <span class="citation" data-cites="McCreery2000">[@McCreery2000]</span>.</li>
<li>A great discussion of <a href="https://www.desertmuseum.org/kids/oz/long-fact-sheets/Pepsis%20Wasp.php">flicker noise</a> including the mathematics of simulating it (not so easy).</li>
</ul>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>


</section>
</section>


<script data-goatcounter="https://chemospec.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script><div id="quarto-appendix" class="default"><aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>A raw signal is generally captured by an ADC (analog-to-digital converter), often decays with time, and raw signals are typically time averaged to improve the signal-to-noise ratio. In this post I’m sticking to a discussion of noise surrounding raw signals, mostly ignoring these processing steps.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>A visual example would be the thermal ellipsoids seen in small molecule x-ray crystallography – some atoms have more movement than others.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Or space.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>In many publications the errors associated with the conversion of captured electron counts in CCD devices to digital signals is referred to as “readout noise”.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The Poisson distribution is a discrete distribution. Technically, for a large number of events, the Poisson converges to the Binomial distribution, another discrete distribution. In either case however, the Gaussian distribution, which is a continuous distribution, is a good substitute when the number of events is large.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hanson2020,
  author = {Hanson, Bryan},
  title = {Simulating {Spectroscopic} {Data} {Part} 2},
  pages = {undefined},
  date = {2020-05-27},
  url = {http://chemospec.org/posts/2021-xx-xx-Sim-Spec-Data-Pt2/2021-xx-xx-Sim-Spec-Data-Pt2.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hanson2020" class="csl-entry quarto-appendix-citeas" role="listitem">
Hanson, Bryan. 2020. <span>“Simulating Spectroscopic Data Part
2.”</span> May 27, 2020. <a href="http://chemospec.org/posts/2021-xx-xx-Sim-Spec-Data-Pt2/2021-xx-xx-Sim-Spec-Data-Pt2.html">http://chemospec.org/posts/2021-xx-xx-Sim-Spec-Data-Pt2/2021-xx-xx-Sim-Spec-Data-Pt2.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="bryanhanson/CSR" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookies are used to track visits only</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>